(function(){var d,q,h,j,b,e,l,r,s,n,t,m,p,k,g,i,a,u,c,o,w,f,v;l={OJ_WAIT:0,OJ_AC:1,OJ_PE:2,OJ_TLE:3,OJ_MLE:4,OJ_WA:5,OJ_OLE:6,OJ_CE:7,OJ_RE_SEGV:8,OJ_RE_FPE:9,OJ_RE_BUS:10,OJ_RE_ABRT:11,OJ_RE_UNKNOWN:12,OJ_RF:13,OJ_SE:14,OJ_RE_JAVA:15,OJ_JUDGING:16,OJ_RUNNING:17,OJ_REJUDGING:18};b={PUBLIC:0,PRIVATE:1,DIY:2,INVITED:3};j={PENDING:"Pending",RUNNING:"Running",ENDED:"Ended"};q={NORMAL:"0",ADMIN:"1",CONSTANT:"2"};h={NONE:0,PASS:1,FAIL:2};r=function(A,y){var z,B,x;z=d(A);B=z.attr("email");x="http://www.gravatar.com/avatar/"+(hex_md5(B))+".jpg?"+(y.size?"s="+y.size+"&":"")+""+(y.rating?"r="+y.rating+"&":"")+""+(y.image?"d="+encodeURIComponent(y.image):"");z.attr("src",x);return A};d=jQuery;d.fn.setAvatar=function(y){var x,z=this;x={size:40,image:"retro",rating:"pg"};d.extend(x,y);return this.each(function(B,A){return r(A,x)})};w=function(x,y,z){return d.ajax({type:"POST",url:x,dataType:"json",contentType:"application/json",data:JSON.stringify(y),success:z})};o=function(y,x){return Object.merge(y,x,false,function(B,A,z){if(A.constructor===Array){A.add(z)}else{A=z}return A})};f=function(x){var y;y=window.open(x,"_blank");return y.focus()};d=jQuery;d.fn.getCursorPosition=function(){if(this.lengh===0){return -1}return d(this).getSelectionStart()};d.fn.setCursorPosition=function(x){if(this.lengh===0){return this}return d(this).setSelection(x,x)};d.fn.getSelection=function(){var y,x;if(this.lengh===0){return -1}x=d(this).getSelectionStart();y=d(this).getSelectionEnd();return this[0].value.substring(x,y)};d.fn.getSelectionStart=function(){var x,z,y;if(this.lengh===0){return -1}x=this[0];z=x.value.length;if(x.createTextRange){y=document.selection.createRange().duplicate();y.moveEnd("character",x.value.length);if(y.text===""){z=x.value.length}z=x.value.lastIndexOf(y.text)}else{if(typeof x.selectionStart!=="undefined"){z=x.selectionStart}}return z};d.fn.getSelectionEnd=function(){var x,z,y;if(this.lengh===0){return -1}x=this[0];z=x.value.length;if(x.createTextRange){y=document.selection.createRange().duplicate();y.moveStart("character",-x.value.length);if(y.text===""){z=x.value.length}z=x.value.lastIndexOf(y.text)}else{if(typeof x.selectionEnd!=="undefined"){z=x.selectionEnd}}return z};d.fn.setSelection=function(z,A){var y,x;if(this.lengh===0){return this}y=this[0];if(y.createTextRange){x=y.createTextRange();x.collapse(true);x.moveEnd("character",A);x.moveStart("character",z);x.select()}else{if(y.setSelectionRange){y.focus();y.setSelectionRange(z,A)}}return this};d.fn.insertAfterCursor=function(A,z){var y,x;if(this.length===0){return this}x=this.getCursorPosition();y=this.val();y=y.insert(A,x);this.val(y);return this.setCursorPosition(x+A.length+z)};n=8;t=function(x){if(x>9){return""+x}else{return"0"+x}};m=function(x,z,y){return""+x+"/"+(t(z+1))+"."+y};s=function(y,B,A){var x,z;x="";A.times(function(C){if(C%n===0){if(C>0){x+="</tr>"}x+="<tr>"}return x+='<td value="!['+(C+1)+"]("+(m(y,C,B))+')">\n  <span><img src="'+(m(y,C,B))+'" class="img-rounded" style="width: 50px; height: 50px"/></span>\n</td>'});x+="</tr>";z='<table class="table table-bordered table-condensed">\n  <tbody>\n    '+x+"\n  </tbody>\n</table>";return z};d=jQuery;d.fn.getFormValue=function(){var y,z,x;y=d(this);z=function(A){return y.attr("type")===A||y[0].localName===A};if(z("radio")){x=d(":radio[name='"+(y.attr("name"))+"']:checked").val();if(x==="all"){x=void 0}return x}else{if(z("select")){x=y.val();if(x===-1){x=void 0}return x}else{return y.val()}}};d.fn.getFormData=function(){var x,y=this;x={};this.each(function(A,B){var I,F,z,D,H,E,G,C;D=["submit","reset","button","image","file"];I=d(B);z=I.find(":input");C=[];for(E=0,G=z.length;E<G;E++){H=z[E];F=d(H);if(D.none(F.attr("type"))){C.push(x[F.attr("name")]=F.getFormValue())}else{C.push(void 0)}}return C});return x};d.fn.setFormValue=function(z){var x,y;x=d(this);y=function(A){return x.attr("type")===A||x[0].localName===A};if(y("radio")){if(z===void 0){z="all"}if(x.attr("value")===z){return x.attr("checked",true)}else{return x.attr("checked",false)}}else{if(y("select")){if(z===void 0){z=-1}return x.val(z)}else{return x.val(z)}}};d.fn.setFormData=function(x){var y=this;return this.each(function(A,B){var I,F,z,D,H,E,G,C;D=["submit","reset","button"];I=d(B);z=I.find(":input");C=[];for(E=0,G=z.length;E<G;E++){H=z[E];F=d(H);if(D.none(F.attr("type"))){C.push(F.setFormValue(x[F.attr("name")]))}else{C.push(void 0)}}return C})};d.fn.resetFormData=function(){var x=this;return this.each(function(z,A){var H,E,y,C,G,D,F,B;C=["submit","reset","button"];H=d(A);y=H.find(":input");B=[];for(D=0,F=y.length;D<F;D++){G=y[D];E=d(G);if(C.none(E.attr("type"))){B.push(E.setFormValue(void 0))}else{B.push(void 0)}}return B})};d.fn.formValidate=function(B){var A,y,z,x,C=this;z={result:{result:"success"},onSuccess:function(){},onFail:function(){}};d.extend(z,B);x=z.result;y=false;if(x.result===null){alert("Unknown exception.")}else{if(x.result==="error"){alert(x.error_msg)}else{if(x.result==="success"){z.onSuccess();y=true}else{if(x.result==="field_error"){A=d(this);x.field.each(function(E){var F,D;D=A.find(":input[name='"+E.field+"']");if(D&&D.length>0){D=d(D.first());F=D.closest("div.form-group");return F.tooltip({trigger:"click",placement:"bottom",title:E.defaultMessage}).tooltip("show")}})}else{alert("Unknown exception.")}}}}if(!y){return z.onFail()}};d=jQuery;d.fn.unescapePre=function(){var x=this;return this.each(function(B,z){var y,A;y=d(z);A=("<pre>"+y[0].innerHTML+"</pre>").unescapeHTML();return y.replaceWith(d("<div>"+A+"</div>"))})};d.fn.unescapeCode=function(){var x=this;return this.each(function(B,z){var y,A;y=d(z);A="<code>"+(y[0].innerHTML.unescapeHTML())+"</code>";return y.replaceWith(A)})};d.fn.renderTable=function(){var x=this;return this.each(function(A,z){var y;y=d(z);return y.addClass("table").addClass("table-bordered").addClass("table-condensed").addClass("cdoj-markdown-table")})};d.fn.renderImage=function(){var x=this;return this.each(function(A,z){var y;return y=d(z)})};d.fn.markdown=function(){var x=this;return this.each(function(C,A){var z,y,B;z=d(A);B=z.html().trim().replace("<textarea>","").replace("</textarea>","").replace("<TEXTAREA>","").replace("</TEXTAREA>","").trim();y=d(marked(B));z.empty().append(y);z.find("code").unescapeCode();z.find("pre").unescapePre();z.find("table").renderTable();return z.find("img").renderImage()})};d=jQuery;d.fn.mathjax=function(){var x=this;MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\[","\\]"]]}});return this.each(function(z,y){return MathJax.Hub.Queue(["Typeset",MathJax.Hub,y])})};d=jQuery;d.fn.prettify=function(){var x=this;return this.find("pre").each(function(B,z){var y,A;y=d(z);if(y.attr("type")!=="no-prettify"){A=prettyPrintOne(y[0].innerText.escapeHTML());return y.empty().append(A)}})};v=function(){d('[type="markdown"]').markdown();MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\[","\\]"]]}});MathJax.Hub.Queue(["Typeset",MathJax.Hub]);return d(document.body).prettify()};p=function(){var y,x;y=location.search;y=y.substr(y.indexOf("?")+1);y=y.split("&");x={};y.each(function(z,A){z=z.split("=");if(z.length===2){return x[z[0]]=z[1]}});return x};e=(function(){function x(y){this.options=y;this.element=this.options.element;if(this.element===null||this.element.length===0){return null}this.createTextarea();this.toolbar()}x.prototype.escape=function(y){return y};x.prototype.createTextarea=function(){var y,z;y=this.element[0].innerHTML.trim();this.element.empty();z='<div class="panel panel-default">\n  <div class="panel-heading" id="flandre-heading">\n    <div class="btn-toolbar" role="toolbar">\n      <div class="btn-group">\n        <button type="button" class="btn btn-default btn-sm" id="tool-preview">Preview</button>\n      </div>\n      <div class="btn-group flandre-tools">\n        <a class="btn btn-default btn-sm" id="tool-emotion"><i class="fa fa-smile-o"></i></a>\n        <a class="btn btn-default btn-sm" id="tool-picture"><i class="fa fa-picture-o"></i></a>\n      </div>\n    </div>\n  </div>\n  <textarea class="tex2jax_ignore form-control" id="flandre-editor">'+(this.escape(y))+'</textarea>\n  <div id="flandre-preview"></div>\n</div>';return this.element.append(z)};x.prototype.toolbar=function(){var E,C,G,z,I,B,F,A,H,y,D=this;E=this.element.find("#flandre-editor");F=this.element.find("#flandre-preview");I=this.options;E.elastic();y=this.element.find("#tool-preview");y.click(function(L){var J,K,M;J=d(L.currentTarget);K=J.hasClass("active");E.css("display","none");F.css("display","none");if(K){E.css("display","block");D.element.find(".flandre-tools").css("display","block")}else{M=E.val().escapeHTML();F.empty().append(M);F.markdown();F.prettify();F.mathjax();F.css("display","block");D.element.find(".flandre-tools").css("display","none")}return J.button("toggle")});A=this.element.find("#tool-emotion");G="emotion-modal-"+(this.element.attr("id"));z='<div class="modal fade" id="'+G+'" tabindex="-1" role="dialog" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h4 class="modal-title">\n          <ul class="nav nav-pills">\n            <li class="active"><a href="#emotion-brd" data-toggle="tab">BRD</a></li>\n          </ul>\n        </h4>\n      </div>\n      <div class="modal-body">\n        <div id="emotion-dialog" style="width: auto;" value="false">\n          <div class="tab-content">\n            <div class="tab-pane active" id="emotion-brd">\n              '+(s("/plugins/cdoj/img/emotion/brd","gif",40))+"\n            </div>\n          </div>\n        </div>\n      </div>\n    </div><!-- /.modal-content -->\n  </div><!-- /.modal-dialog -->\n</div><!-- /.modal -->";d(document.body).append(z);C=d("#"+G);A.click(function(){return C.modal("show")});C.on("shown.bs.modal",function(){var J=this;return C.find("#emotion-dialog").find("td").on("click",function(M){var K,L;K=d(M.currentTarget);L=K.attr("value");E.insertAfterCursor(L,0);return C.modal("hide")})});H=this.element.find("#tool-picture");return B=new qq.FineUploaderBasic({button:H[0],request:{endpoint:I.picture.uploadUrl,inputName:"uploadFile"},validation:{allowedExtensions:["jpeg","jpg","gif","png"],sizeLimit:10*1024*1024},multiple:false,callbacks:{onComplete:function(M,L,K){var J;if(K.success==="true"){J="!["+K.uploadedFile+"]("+K.uploadedFileUrl+")";return E.insertAfterCursor(J,0)}else{return console.log(K)}}}})};x.prototype.getText=function(){return this.element.find("#flandre-editor").val()};return x})();d=jQuery;d.fn.flandre=function(x){var y;if(x!==void 0){x.element=d(this)}else{x={element:d(this)}}y=new e(x);return y};i=function(){var y,z,C,E,D,x,I,H,F,A,G,B;z=d("#cdoj-navbar");y=d("#cdoj-container");E=z.find("#cdoj-user");C=z.find("#cdoj-navbar-menu");x=y.find("#mzry1992-header");D=y.find("#mzry1992-container");if(x.length!==0&&D.length!==0){D.css("margin-top",x.outerHeight())}I=window.location.pathname;H="home";B=["problem","contest","status","user","admin"];for(A=0,G=B.length;A<G;A++){F=B[A];if(I.startsWith("/"+F+"/")){H=F}}return C.find("#menu-item-"+H).addClass("cdoj-menu-selected")};k=function(){var A,y,x,z,B=this;A=d("#article-editor");if(A.length>0){y=d("#article-editor-title").attr("value");z=["content"];x=[];z.each(function(C,D){return x.push({id:C,editor:d("#"+C).flandre({picture:{uploadUrl:"/picture/uploadPicture/article/"+y}})})});return d("#submit").click(function(){var C;C={sampleInput:d("textarea#sample-input").val(),sampleOutput:d("textarea#sample-output").val(),title:d("#title").val(),source:d("#source").val()};x.each(function(D,E){return C[D.id]=D.editor.getText()});if(y==="new"){C.action="new"}else{C.action="edit";C.articleId=y}w("/article/edit",C,function(D){if(D.result==="success"){return window.location.href="/article/show/"+D.articleId}else{if(D.result==="field_error"){return alert("Please enter a valid title!")}else{return alert(D.error_msg)}}});return false})}};g=function(){var A,D,I,H,B,E,J,C,x,z,F,y,G=this;A=d("#contest-show");if(A.length>0){I=d("#contest-title").attr("value");x=d("#contest-current-time").attr("value");y=d("#contest-start-time").attr("value");F=d("#contest-end-time").attr("value");C=d("#contest-type").attr("value");B=d("#contest-status").attr("value");J=d("#contest-show-tab");H=d("#contest-problem-summary");E=J.find("a[href='#tab-contest-status']");D=d("#contest-progress-bar");if(B===j.PENDING){}else{if(B===j.RUNNING){}else{if(B===j.ENDED){D.addClass("progress-bar-success").css("width","100%")}}}H.find("a").click(function(N){var L,K,M;L=d(N.currentTarget);K=L.attr("href");if(K.startsWith("#")){M=J.find("a[href='"+K+"']");if(M.length>0){M.tab("show")}return false}else{return true}});z=getCurrentUser();if(z.userLogin){d("#submit-code").click(function(){var K;K={codeContent:d("#code-content").val(),languageId:d(":radio[name='language']:checked").attr("value"),contestId:I,problemId:d("#problem-selector").find("option:selected").val()};w("/status/submit",K,function(L){if(L.result==="error"){return alert(L.error_msg)}else{if(L.result==="success"){return E.tab("show")}}});return false})}initContestStatusList(I)}};a=function(){var y,x,A,z,B=this;if(d("#problem-show").length>0){y=d("#currentUser");this.userLogin=y.length!==0?true:false;A=d("#problem-title").attr("value");if(this.userLogin){d("#submit-code").click(function(){var C;C={codeContent:d("#code-content").val(),languageId:d(":radio[name='language']:checked").attr("value"),contestId:null,problemId:A};w("/status/submit",C,function(D){if(D.result==="error"){return alert(D.error_msg)}else{if(D.result==="success"){return window.location.href="/status/list"}}});return false})}x=d("#cdoj-best-solutions");if(x.length!==0){return z=new ListModule({listContainer:x,requestUrl:"/status/search",condition:{currentPage:null,countPerPage:10,startId:void 0,endId:void 0,userName:void 0,problemId:A,languageId:void 0,contestId:void 0,result:"OJ_AC",orderFields:"timeCost,memoryCost,Length,statusId",orderAsc:"true,true,true,true"},formatter:function(F){var C,D,E,G;E=function(I,H){return'<td style="text-align: center;">'+H+' KB</td>\n<td style="text-align: center;">'+I+" MS</td>"};C=getCurrentUser();G=function(I,H,K,J){if(H===7){if(C.userLogin&&(C.currentUserType==="1"||C.currentUser===J)){return'<a href="#" value="'+K+'" class="ce-link">'+I+"</a>"}else{return I}}else{return I}};D=function(H,K,J,I){if(C.userLogin&&(C.currentUserType==="1"||C.currentUser===I)){return'<a href="#" value="'+J+'" class="code-link">'+H+" B</a>"}else{return""+H+" B"}};return'<tr>\n  <td style="text-align: center;">'+F.statusId+'</td>\n  <td style="text-align: center;"><a href="/user/center/'+F.userName+'" target="_blank">'+F.userName+"</a></td>\n\n  "+(F.returnTypeId===1?E(F.timeCost,F.memoryCost):"<td></td><td></td>")+'\n\n  <td style="text-align: center;">'+F.language+'</td>\n\n  <td style="text-align: center;">'+(D(F.length,F.language,F.statusId,F.userName))+'</td>\n  <td style="text-align: center;">'+(Date.create(F.time).format("{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}"))+"</td>\n  <td></td>\n</tr>"},after:function(){var C=this;return d(".code-link").click(function(E){var D,F;D=d(E.currentTarget);F=D.attr("value");d.post("/status/info/"+F,function(I){var G,H;H="";if(I.result==="success"){H=I.code}else{H=I.error_msg}H=H.trim().escapeHTML();console.log(H);G=d("#code-modal");G.find(".modal-body").empty().append("<pre>"+H+"</pre>");G.find(".modal-body").prettify();return G.modal("toggle")});return false})}})}}};u=function(){var x=this;d(".dropdown-menu").find("form").click(function(y){return y.stopPropagation()});return d("img[type='avatar']").each(function(A,z){var y;y=d(z);return y.setAvatar({size:y.width()?y.width():void 0})})};c=function(){var y,x;y=d("#user-list");if(y.length!==0){return x=new ListModule({listContainer:y,requestUrl:"/user/search",condition:{currentPage:null,startId:void 0,endId:void 0,userName:void 0,type:void 0,school:void 0,departmentId:void 0,orderFields:"solved,tried,id",orderAsc:"false,false,true"},formatter:function(A){var z;z=function(){var B;B="";if(this.user.userLogin&&this.user.currentUserType===q.ADMIN){B+='<div class="btn-toolbar" role="toolbar" style="position: absolute; top: 12px; right: 30px;">\n      <div class="btn-group">\n        <button type="button" class="btn btn-default btn-sm admin-profile-edit" user-name="'+A.userName+'">\n          <i class="fa fa-pencil"></i>\n        </button>\n      </div>\n    </div>'}return B};return'<div class="col-lg-6">\n  <div class="panel panel-default">\n    <div class="panel-body">\n      <div class="media">\n        <a class="pull-left" href="#">\n          <img id="cdoj-users-avatar" email="'+A.email+'"/>\n        </a>\n        <div class="media-body">\n          <h4 class="media-heading"><a href="/user/center/'+A.userName+'" target="_blank">'+A.nickName+" <small>"+A.userName+'</small></a></h4>\n          <span><i class="fa fa-map-marker"></i>'+A.school+'</span>\n          <br/>\n          <span><a href="/status/list?userName='+A.userName+'" target="_blank">'+A.solved+"/"+A.tried+"</a></span>\n          "+(z())+'\n        </div>\n      </div>\n    </div>\n    <div class="panel-footer" style="overflow: hidden;white-space: nowrap;text-overflow: ellipsis;">Motto: '+A.motto+"</div>\n  </div>\n</div>"},after:function(){var z,B,A,C=this;d("img#cdoj-users-avatar").setAvatar({size:64});A=d("#cdoj-admin-profile-edit-modal");z=d("#cdoj-admin-profile-edit-form");B=d("#cdoj-admin-profile-edit-form-onloading");d(".admin-profile-edit").click(function(F){var D,E;D=d(F.currentTarget);A.modal();E=D.attr("user-name");d.post("/user/secretProfile/"+E,function(G){console.log(G);z.setFormData(G.user);z.css("display","block");return B.css("display","none")});A.on("hidden.bs.modal",function(){z.css("display","none");return B.css("display","block")});return false});return d("#cdoj-admin-profile-edit-button").click(function(){var D;D=z.getFormData();if(D.newPassword===""){delete D.newPassword}if(D.newPasswordRepeat===""){delete D.newPasswordRepeat}w("/user/adminEdit",D,function(E){return z.formValidate({result:E,onSuccess:function(){A.modal("hide");return x.triggerRefresh()}})});return false})}})}};d=jQuery;d(function(){u();i();g();k();return v()})}).call(this);